---
title: "Depth Profiles"
author: "Lilah McCormick"
date: '2022-06-30'
output: 
  html_document:
    toc: yes
    toc_float: yes 
    theme: default 
    highlights: monotone
---

#### Before Starting: Load libraries
```{r = load_packages, message = FALSE, results = FALSE}
library(lubridate)
library(tidyverse)
library(plotly)
library(DT)
library(glue)
source("src/util.R")
source("src/data.R")
```

#### Read filed into a dataframe, and make DateTimes compatible with POSIXct
```{r = fix_datetimes, message = FALSE, results = FALSE}
depth_asgeir <- read_depth(find_depth("asgeir"))
depth_balder <- read_depth(find_depth("balder"))
```

#### Dive Profile Plots:  
```{r = plot_asgeir_depth, echo = FALSE, messages = FALSE}
# plot whole deployment 
start_dep_asgeir <- depth_asgeir$DateTime[1]
end_dep_asgeir <- depth_asgeir$DateTime[nrow(depth_asgeir)]
plot_dive(depth_asgeir, start_dep_asgeir, end_dep_asgeir, "Asgeir Dive Profile 2018 Deployment")
#plot day
start_day <- ymd_hms('2018-08-24 00:00:00')
end_day <- start_day + days(1)
plot_dive(depth_asgeir, start_day, end_day, "Asgeir Dive Profile August 24, 2018")
#plot one dive 
start_dive <- ymd_hms('2018-08-24 08:26:01')
end_dive <- ymd_hms('2018-08-24 08:49:04')
plot_dive(depth_asgeir, start_dive, end_dive, "Asgeir Dive Profile Single Dive August 24, 2018", TRUE)
```

```{r plot_balder_depth, echo = FALSE, messages = FALSE}
start_dep_balder <- 	depth_balder$DateTime[1]
end_dep_balder <- depth_balder$DateTime[nrow(depth_balder)]
plot_dive(depth_balder, start_dep_balder, end_dep_balder, "Balder Dive Profile 2018 Deployment")
```


```{r plot_dive_phases}
start_time <- ymd_hms('2016-08-24 20:43:13')
end_time <- ymd_hms('2016-08-24 21:02:20')
one_dive <- filter(depth_balder, DateTime >= start_time, DateTime <= end_time)

start_1 <- ymd_hms('2016-08-24 20:43:13')
end_1 <- ymd_hms('2016-08-24 20:45:23')
surface <- filter(depth_balder, DateTime >= start_1, DateTime <= end_1)

start_2 <- ymd_hms('2016-08-24 20:45:23')
end_2 <- ymd_hms('2016-08-24 21:02:20')
descent <- filter(depth_balder, DateTime >= start_2, DateTime <= end_2)

phase <- c("surface", "descent")
times <- c(surface, descent)
phase_times <- data.frame(dive_phase = phase, start_time = c(start_1, start_2), end_time = c(end_1, end_2))

one_dive$color <- apply(one_dive, 
                  1, 
                  FUN = function(x) if(x[4] >= start_1 & x[4] <= end_1) 0 else 1) #not working the way I want it to 
         

dive_plot <- ggplot(one_dive, aes(x = DateTime, y = Depth, color = color)) +
  geom_line() +
  scale_y_reverse() + #makes depth right orientation 
  labs(x = "Time",
       y = "Depth (m)") + #changes labels on axes and title 
  theme(line = element_blank(), 
        rect = element_blank(), 
        text = element_text(size = 16),
        axis.text.x = element_blank(), 
        axis.text.y = element_blank()
        )  #white background

dive_plot
```

