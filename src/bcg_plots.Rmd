---
title: "bcg_plots"
author: "Lilah McCormick"
date: "2022-08-10"
output: html_document
---

```{r}
# source("src/data.R")
# library(tidyverse)
# library(ggplot2)
# library(gridExtra)
# library(stringr)
```

```{r}
balder_bcg <- readRDS(find_BCG("balder")) %>% 
  filter(rid == "251") 
```

```{r filtered_acc}
filt_acc <- balder_bcg %>% 
  select("DateTime", "acc_x_filt", "acc_y_filt", "acc_z_filt") %>% 
  pivot_longer(
    cols = acc_x_filt:acc_z_filt, 
    names_to = "axis",
    values_to = "acc_filt"
  )


filt_acc_plot <- ggplot(filt_acc, aes(x = DateTime, y = acc_filt, color = axis)) +
  geom_line() +
  facet_wrap(vars(axis), 
             nrow = 3) +
  theme(legend.position = "none",
        strip.background = element_blank(),
        strip.text = element_blank(),
        line = element_blank(), 
        rect = element_blank(), 
        axis.text.y = element_blank(),
        axis.title.y = element_text(size = 8)) + 
  labs(x = "time",
       y = str_wrap("filtered acceleration", 10)
  )


filt_acc_plot
```

```{r differenced_acc}
diff_acc <- balder_bcg %>% 
  mutate(jerk_x = jerk[,1], jerk_y = jerk[,2], jerk_z = jerk[,3]) %>% 
  select(DateTime, jerk_x, jerk_y, jerk_z) %>% 
  pivot_longer(
    cols = jerk_x:jerk_z, 
    names_to = "axis",
    values_to = "acc_diff"
  )

diff_acc_plot <- ggplot(diff_acc, aes(x = DateTime, y = acc_diff, color = axis)) +
  geom_line() +
  facet_wrap(vars(axis), 
             nrow = 3) +
  theme(legend.position = "none",
        strip.background = element_blank(),
        strip.text = element_blank(),
        line = element_blank(), 
        rect = element_blank(),
        axis.title.y = element_text(size = 8),
        axis.text.y = element_blank()) + 
  labs(x = "time",
       y = str_wrap("differenced acceleration", 10)
  )

diff_acc_plot
```

```{r se}
se <- balder_bcg %>% 
  select(DateTime, jerk_se)

se_plot <- ggplot(se, aes(x = DateTime, y = jerk_se)) +
  geom_line() +
  theme(strip.background = element_blank(),
        strip.text = element_blank(),
        line = element_blank(), 
        rect = element_blank(), 
        axis.text.y = element_blank(),
        axis.title.y = element_text(size = 8)) + 
  labs(x = "time",
       y = str_wrap("shannon entropy", 10)
  )

se_plot
```

```{r smooth}
smooth <- balder_bcg %>% 
  select(DateTime, jerk_smooth)

smooth_plot <- ggplot(smooth, aes(x = DateTime, y = jerk_smooth)) +
  geom_line() +
  theme(strip.background = element_blank(),
        strip.text = element_blank(),
        line = element_blank(), 
        rect = element_blank(), 
        axis.text.y = element_blank(),
        axis.title.y = element_text(size = 8)) + 
  labs(x = "time",
       y = str_wrap("smoothed signal", 10)
  )

smooth_plot

#FIXME this looks seriously wrong
```

```{r arrange}
bcg_plots <- list(filt_acc_plot, diff_acc_plot, se_plot, smooth_plot) %>% map(~.x + labs(x=NULL))

bcg_plot_comb <- grid.arrange(grobs = bcg_plots, 
             nrow = 4, 
             bottom = "time (s)")

#ggsave("figures/balder_bcg_plots.jpg", bcg_plot_comb, device="jpeg", width = 10, height = 7)
```
