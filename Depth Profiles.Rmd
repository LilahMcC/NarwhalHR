---
title: "Depth Profiles"
author: "Lilah McCormick"
date: '2022-06-30'
output: 
  html_document:
    toc: yes
    toc_float: yes 
    theme: default 
    highlights: monotone
---
# Questions for Max:
1. Do I need to install a package at the beginning of every RMarkdown file? eg. lubridate  
1. Do I need to call the library at the beginning of every chunk of code? 


# Before Starting: load libraries
```{r = load_packages, eval = FALSE}
library(lubridiate)
library(dplyr)
library(tidyverse)
library(DT)
library(plotly)
```


# Task #1: Read the file into a dataframe.   
### Step 1: load the data.
```{r = read_txt_file}
depth_data <- read.delim("Depth_Asgeir.txt")
header <- head(depth_data)
class(depth_data) #checks that the file has been read as a dataframe.
```
    
# Task #2: Convert the datetime column from character to POSIXct.   
### Step 1: Outline changes that need to happen.    
Format of datetime entry in data:    
`m/dd/yy hh:mm:ss`
`parse_datetime()` expects: 
`yyyy/mm/dd hh:mm:ss`

### Step 2: Figure out how we need to manipulate the given date using the date from the first entry  
```{r = practice_datetime}
library(lubridate)
line_one <- "8/23/18 22:46:01"
dt_conversion <- "m/%d/%y %H:%M:%S"
parse_date_time(line_one, dt_conversion)
```

### Step 3: Test it on the header. I'm pretty sure there's a better way to do this, but I haven't figured it out. 
```{r = header_datetime_test}
library(dplyr)
header_datetime <- pull(header, "Date.time") #create a vector with first 6 datetimes
UTC_date_time <- parse_date_time(header_datetime, dt_conversion) #vector with first 6 datetimes in UTC
UTC_df <- data.frame(UTC_date_time) #turn the vector back into a column 
UTC_header <- mutate(header, UTC_df, .before = "Date.time") #adds the UTC date time column into the header df before the old datetime column 
select(UTC_header, -c("Date.time")) #Delete the old datetime column 
```

### Step 4: Apply this set of functions to the whole dataset. 
```{r full_dt_conversion, message = FALSE}
datetime_col <- pull(depth_data, "Date.time") #creates a vector with all datetimes
UTC_vec <- parse_date_time(datetime_col, dt_conversion) #changes into UTC
UTC_col <- data.frame(UTC_vec) #changes it back into a df 
depth_data_UTC <- mutate(depth_data, UTC_col, .before = "Date.time") #Adds UTC datetime column in before old date time column 
depth_data_UTC <- select(depth_data_UTC, -c("Date.time")) #delete old datetime column
depth_data_UTC <- rename(depth_data_UTC, DateTime = UTC_vec) #renames the datetime column 
```

### Step 5: Print header to show the new table
```{r = print_new_header}
head(depth_data_UTC)
```

# Task #3 Make Figures
1. Depth profile for the whole deployment
1. Depth profile for 1 day 
1. Depth profile for 1 dive 

### Step 1: Make a plot for the whole deployment   
```{r plot_deployment}
library(tidyverse)
library(plotly)
deployment_plot <- ggplot(depth_data_UTC, aes(x = DateTime, y = Depth)) + 
  geom_line() +
  scale_y_reverse() + #makes depth right orientation 
  labs(title = "Asgeir Depth Profile 2018",
       x = "Time",
       y = "Depth (m)") + #changes labels on axes and title 
  theme_bw()  #white background 
ggplotly(deployment_plot)
```

### Step 2: Make a plot for 1 day  

I'm a little confused on this one - This is a 24 hour period, but it doesn't start at midnight, and I think we might need to know the timezone for this one.
```{r plot_day}
library(plotly)
start_day <- as.POSIXct('2018-08-24 00:00:00')
end_day <- as.POSIXct('2018-08-24 23:59:59')
one_day <- dplyr::filter(depth_data_UTC, DateTime >= start_day, DateTime <= end_day)
day_plot<- ggplot(one_day, aes(x = DateTime, y = Depth)) + #filters datetime to 24 hour period
  geom_line() +
  scale_y_reverse() + #makes depth right orientation 
  labs(title = "Asgeir 24 Hour Depth Profile 2018",
       x = "Time",
       y = "Depth (m)") + #changes labels on axes and title 
  theme_bw()  #white background 
ggplotly(day_plot) #makes plot interactive 
```

### Step 3: Make a plot for 1 dive
Also have to figure out some time zone stuff on this one. 
```{r}
library(plotly)
start_dive_time <- as.POSIXct('2018-08-24 15:26:01') #selected times from interactive day plot 
end_dive_time <- as.POSIXct('2018-08-24 15:49:04')
one_dive <- dplyr::filter(depth_data_UTC, DateTime >= start_dive_time, DateTime <= end_dive_time)
dive_plot <- ggplot(one_dive, aes(x = DateTime, y = Depth)) + #filters datetime to 24 hour period
  geom_line() +
  scale_y_reverse() + #makes depth right orientation 
  labs(title = "Asgeir Single Dive Depth Profile 2018",
       x = "Time",
       y = "Depth (m)") + #changes labels on axes and title 
  theme_bw()  #white background 
ggplotly(dive_plot)
```



